<!DOCTYPE html>
<html>
<head>
    <title>Login Test</title>
    <style>
        body { font-family: Arial; padding: 2rem; }
        .test { margin: 1rem 0; padding: 1rem; border: 1px solid #ddd; }
        .success { background: #d4edda; }
        .error { background: #f8d7da; }
        button { padding: 0.5rem 1rem; margin: 0.5rem; cursor: pointer; }
    </style>
</head>
<body>
    <h1>RTB Login System Test</h1>
    
    <div id="results"></div>
    
    <button onclick="testBackend()">1. Test Backend Connection</button>
    <button onclick="testDatabase()">2. Test Database</button>
    <button onclick="testAdminLogin()">3. Test Admin Login</button>
    <button onclick="testUserLogin()">4. Test User Login</button>
    <button onclick="runAllTests()">Run All Tests</button>
    
    <script>
        const API_BASE = 'http://localhost:8000';
        
        function addResult(title, success, message) {
            const div = document.createElement('div');
            div.className = 'test ' + (success ? 'success' : 'error');
            div.innerHTML = `<strong>${success ? '✅' : '❌'} ${title}</strong><br>${message}`;
            document.getElementById('results').appendChild(div);
        }
        
        async function testBackend() {
            try {
                const response = await fetch(`${API_BASE}/`);
                const data = await response.json();
                addResult('Backend Connection', true, `Status: ${data.status}, Message: ${data.message}`);
            } catch (error) {
                addResult('Backend Connection', false, `Error: ${error.message}`);
            }
        }
        
        async function testDatabase() {
            try {
                const response = await fetch(`${API_BASE}/health`);
                const data = await response.json();
                addResult('Database Connection', data.status === 'healthy', 
                    `Status: ${data.status}, Database: ${data.database}`);
            } catch (error) {
                addResult('Database Connection', false, `Error: ${error.message}`);
            }
        }
        
        async function testAdminLogin() {
            try {
                const response = await fetch(`${API_BASE}/users/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        phone: '+250789751597', 
                        password: 'admin123' 
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    addResult('Admin Login', true, 
                        `User: ${data.name}, Role: ${data.role}, Phone: ${data.phone}`);
                } else {
                    const error = await response.json();
                    addResult('Admin Login', false, `Error: ${error.detail}`);
                }
            } catch (error) {
                addResult('Admin Login', false, `Error: ${error.message}`);
            }
        }
        
        async function testUserLogin() {
            try {
                const response = await fetch(`${API_BASE}/users/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        phone: '0796014803', 
                        password: '12345678' 
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    addResult('User Login', true, 
                        `User: ${data.name}, Role: ${data.role}, Phone: ${data.phone}`);
                } else {
                    const error = await response.json();
                    addResult('User Login', false, `Error: ${error.detail}`);
                }
            } catch (error) {
                addResult('User Login', false, `Error: ${error.message}`);
            }
        }
        
        async function runAllTests() {
            document.getElementById('results').innerHTML = '';
            await testBackend();
            await testDatabase();
            await testAdminLogin();
            await testUserLogin();
        }
    </script>
</body>
</html>
